#!/usr/bin/env node

// Helper functions from utils.ts
function pad(paddingLeft, arr, paddingRight = 0) {
	return [...new Array(paddingLeft).fill(0), ...arr, ...new Array(paddingRight).fill(0)];
}

function same(byte, times) {
	return new Array(times).fill(byte).flat();
}

function mirr(toBeMirrored, middle = []) {
	return [...toBeMirrored, ...middle, ...toBeMirrored.slice().reverse()];
}

function invert(bytes) {
	return bytes.map(byte => ~byte);
}

function bitmapToAscii(bitmap, width) {
	return bitmap.map(byte => {
		let row = '';
		for (let i = 0; i < width; i++) {
			const mask = 1 << (width - 1 - i);
			row += (byte & mask) ? '#' : ' ';
		}
		return row;
	});
}

function formatGlyph(glyph, charCode) {
	const charSymbol = charCode >= 32 && charCode <= 126 ? String.fromCharCode(charCode) : '';
	const comment = charSymbol ? ` // ${charCode} '${charSymbol}'` : ` // ${charCode}`;
	const lines = [`\t[${comment}`];
	glyph.forEach(row => {
		lines.push(`\t\t'${row}',`);
	});
	lines.push('\t],');
	return lines.join('\n');
}

// Font array copied from 8x16/ascii.ts
const font8x16 = [
	pad(16, []), // Space
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(16, []), //
	pad(3, [0b00010000, 0b00111000, 0b01101100, ...same(0b11000110, 3), 0b11111110, ...same(0b11000110, 3)], 3), // !
	pad(6, [...same(0b00001010, 3), ...same(0b00000000, 5)], 2), // "
	pad(5, [...same(0b01101100, 2), 0b11111110, ...same(0b01101100, 2), 0b11111110, ...same(0b01101100, 2)], 3), // #
	pad(6, [0b00000100, ...mirr([0b00001110, 0b00010101], [0b00010100, 0b00001110, 0b0000101]), 0b00000100], 1), // $
	pad(
		6,
		[0b00001000, 0b00010100, 0b00001001, 0b00000010, 0b00000100, 0b00001000, 0b00010010, 0b00000101, 0b00000010],
		1
	), // %
	pad(6, [0b00001100, 0b00010010, 0b00010000, 0b00001000, 0b00010101, 0b00010010, 0b00010010, 0b00001101], 2), // &
	pad(6, [0b00000100, 0b00000100], 8), // '
	pad(6, mirr([0b00000010, 0b00000100, 0b00000100, 0b00001000]), 2), // (
	pad(6, mirr([0b00001000, 0b00000100, 0b00000100, 0b00000010]), 2), // )
	pad(6, mirr([0b000010000, 0b01010100, 0b00111000]), 4), // *
	pad(4, [0b00011000, 0b00011000, 0b00011000, 0b11111111, 0b11111111, 0b00011000, 0b00011000, 0b00011000], 4), // +
	pad(12, [0b00001100, 0b00001100, 0b00000100, 0b00001000], 0), // ,
	pad(7, [0b01111110, 0b01111110], 7), // -
	pad(11, [0b00011000, 0b00011000], 3), // .
	pad(
		3,
		[
			0b00000110, 0b00000110, 0b00001100, 0b00001100, 0b00011000, 0b00011000, 0b00110000, 0b00110000, 0b01100000,
			0b01100000,
		],
		3
	), // /

	/* 0-9 */
	pad(3, [...mirr([0b00111000, 0b01101100, 0b11000110], [0b11001110, 0b11010110, 0b11100110, 0b11000110, 0b01101100])], 3), // 0
	pad(3, [0b00011000, 0b00111000, 0b01111000, ...same(0b00011000, 5), 0b01111110, 0b01111110], 3), // 1
	pad(
		3,
		[
			0b00111100, 0b01100110, 0b11000110, 0b00000110, 0b00001100, 0b00011000, 0b00110000, 0b01100000, 0b11111110,
			0b11111110,
		],
		3
	), // 2
	pad(
		3,
		[
			0b00111100, 0b01100110, 0b11000110, 0b00000110, 0b00111100, 0b00000110, 0b00000110, 0b11000110, 0b01100110,
			0b00111100,
		],
		3
	), // 3
	pad(
		3,
		[
			0b00000110, 0b00001110, 0b00011110, 0b00110110, 0b01100110, 0b11000110, 0b11111110, 0b11111110, 0b00000110,
			0b00000110,
		],
		3
	), // 4
	pad(
		3,
		[
			0b11111110, 0b11111110, 0b11000000, 0b11111100, 0b11111110, 0b00000110, 0b00000110, 0b11000110, 0b01111100,
			0b00111000,
		],
		3
	), // 5
	pad(
		3,
		[
			0b00111100, 0b01100110, 0b11000000, 0b11111100, 0b11111110, 0b11000110, 0b11000110, 0b11000110, 0b01101100,
			0b00111000,
		],
		3
	), // 6
	pad(
		3,
		[
			0b11111110, 0b11111110, 0b11000110, 0b00000110, 0b00001100, 0b00011000, 0b00110000, 0b00110000, 0b00110000,
			0b00110000,
		],
		3
	), // 7
	pad(
		3,
		[
			0b00111000, 0b01101100, 0b11000110, 0b11000110, 0b01111100, 0b11000110, 0b11000110, 0b11000110, 0b01101100,
			0b00111000,
		],
		3
	), // 8
	pad(
		3,
		[
			0b00111000, 0b01101100, 0b11000110, 0b11000110, 0b11000110, 0b01111110, 0b00111110, 0b00000110, 0b01100110,
			0b00111100,
		],
		3
	), // 9

	pad(7, [0b00011000, 0b00011000, 0b00000000, 0b00000000, 0b00011000, 0b00011000], 3), // :
	pad(7, [0b00001100, 0b00001100, 0b00000000, 0b00000000, 0b00001100, 0b00001100, 0b00000100, 0b00001000], 1), // ;
	pad(4, [...mirr([0b00000110, 0b00011000, 0b01100000], [0b10000000])], 4), // <
	pad(6, [0b11111110, 0b11111110, 0b00000000, 0b11111110, 0b11111110], 5), // =
	pad(4, [...mirr([0b01100000, 0b00011000, 0b00000110], [0b00000001])], 4), // >
	pad(
		3,
		[
			0b00111100, 0b01100110, 0b11000110, 0b00000110, 0b00001100, 0b00011000, 0b00011000, 0b00000000, 0b00011000,
			0b00011000,
		],
		3
	), // ?
	pad(16, []), // @

	/* A-Z */
	pad(
		3,
		[0b00010000, 0b00111000, 0b01101100, ...same(0b11000110, 3), 0b11111110, ...same(0b11000110, 3)],
		3
	), // A
	pad(
		3,
		[
			0b11111100, 0b01100110, 0b01100110, 0b01111100, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110,
			0b11111100,
		],
		3
	), // B
	pad(
		3,
		[
			0b00111100, 0b01100110, 0b11000110, 0b11000000, 0b11000000, 0b11000000, 0b11000000, 0b11000110, 0b01100110,
			0b00111100,
		],
		3
	), // C
	pad(
		3,
		[
			0b11111000, 0b01101100, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01101100,
			0b11111000,
		],
		3
	), // D
	pad(
		3,
		[
			0b11111110, 0b01100010, 0b01100000, 0b01111000, 0b01111000, 0b01100000, 0b01100000, 0b01100010, 0b01100010,
			0b11111110,
		],
		3
	), // E
	pad(
		3,
		[
			0b11111110, 0b01100010, 0b01100000, 0b01111000, 0b01111000, 0b01100000, 0b01100000, 0b01100000, 0b01100000,
			0b11110000,
		],
		3
	), // F
	pad(
		3,
		[
			0b00111100, 0b01100110, 0b11000110, 0b11000000, 0b11000000, 0b11001110, 0b11000110, 0b11000110, 0b01100110,
			0b00111010,
		],
		3
	), // G
	pad(
		3,
		[
			0b11000110, 0b11000110, 0b11000110, 0b11111110, 0b11111110, 0b11000110, 0b11000110, 0b11000110, 0b11000110,
			0b11000110,
		],
		3
	), // H
	pad(3, [0b00111100, ...same(0b00011000, 8), 0b00111100], 3), // I
	pad(3, [0b00011110, ...same(0b00001100, 5), 0b11001100, 0b11001100, 0b11001100, 0b01111000], 3), // J
	pad(
		3,
		[
			0b11100110, 0b01100110, 0b01101100, 0b01111000, 0b01110000, 0b01111000, 0b01101100, 0b01100110, 0b01100110,
			0b11100111,
		],
		3
	), // K
	pad(3, [0b11110000, ...same(0b01100000, 6), 0b01100010, 0b01100010, 0b11111110], 3), // L
	pad(
		3,
		[
			0b11000011, 0b11100111, 0b11111111, 0b11111111, 0b11011011, 0b11000011, 0b11000011, 0b11000011, 0b11000011,
			0b11000011,
		],
		3
	), // M
	pad(
		3,
		[
			0b11000110, 0b11100110, 0b11100110, 0b11110110, 0b11111110, 0b11011110, 0b11001110, 0b11000110, 0b11000110,
			0b11000110,
		],
		3
	), // N
	pad(
		3,
		[
			0b00111000, 0b01101100, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b01101100,
			0b00111000,
		],
		3
	), // O
	pad(
		3,
		[
			0b11111100, 0b01100110, 0b01100110, 0b01100110, 0b01111100, 0b01100000, 0b01100000, 0b01100000, 0b01100000,
			0b11110000,
		],
		3
	), // P
	pad(
		3,
		[
			0b00111000, 0b01101100, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11010110, 0b01101100,
			0b00111010,
		],
		3
	), // Q
	pad(
		3,
		[
			0b11111100, 0b01100110, 0b01100110, 0b01100110, 0b01111100, 0b01101100, 0b01100110, 0b01100110, 0b01100110,
			0b11100110,
		],
		3
	), // R
	pad(
		3,
		[
			0b00111100, 0b01100110, 0b11000110, 0b01100000, 0b00111000, 0b00001100, 0b00000110, 0b11000110, 0b01100110,
			0b00111100,
		],
		3
	), // S
	pad(3, [0b01111110, 0b01111110, 0b01011010, ...same(0b00011000, 7)], 3), // T
	pad(
		3,
		[
			0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b01101100,
			0b00111000,
		],
		3
	), // U
	pad(
		3,
		[
			0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b11000110, 0b01101100, 0b00111000,
			0b00010000,
		],
		3
	), // V
	pad(
		3,
		[
			0b11000011, 0b11000011, 0b11000011, 0b11000011, 0b11011011, 0b11011011, 0b11111111, 0b11100111, 0b01100110,
			0b01100110,
		],
		3
	), // W
	pad(
		3,
		[
			0b11000110, 0b11000110, 0b01101100, 0b01101100, 0b00111000, 0b00111000, 0b01101100, 0b01101100, 0b11000110,
			0b11000110,
		],
		3
	), // X
	pad(3, [0b01100110, 0b01100110, 0b01100110, 0b00111100, ...same(0b00011000, 6)], 3), // Y
	pad(
		3,
		[
			0b11111110, 0b11000110, 0b10000110, 0b00001100, 0b00011000, 0b00110000, 0b01100000, 0b11000010, 0b11000110,
			0b11111110,
		],
		3
	), // Z

	pad(4, [0b11110000, ...same(0b11000000, 8), 0b11110000], 2), // [
	pad(
		3,
		[
			0b11000000, 0b11000000, 0b01100000, 0b01100000, 0b00110000, 0b00110000, 0b00011000, 0b00011000, 0b00001100,
			0b00001100,
		],
		3
	), // backslash
	pad(4, [0b11110000, ...same(0b00110000, 8), 0b11110000], 2), // ]
	pad(3, [0b00010000, 0b00111000, 0b01101100, 0b11000110], 9), // ^
	pad(13, [0b11111111, 0b11111111], 1), // _
	pad(5, [0b00110000, 0b00011000, 0b00001100], 8), // `

	/* a-z */
	pad(5, [0b01111000, 0b00001100, 0b01111100, 0b11001100, 0b11001100, 0b11001100, 0b01110110], 4), // a
	pad(3, [0b11100000, 0b01100000, 0b01111100, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01111100], 4), // b
	pad(5, [0b01111000, 0b11001100, 0b11000000, 0b11000000, 0b11000000, 0b11001100, 0b01111000], 4), // c
	pad(3, [0b00011100, 0b00001100, 0b01111100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b01110110], 4), // d
	pad(5, [0b01111000, 0b11001100, 0b11111100, 0b11000000, 0b11000000, 0b11001100, 0b01111000], 4), // e
	pad(3, [0b00111000, 0b01101100, 0b01100000, 0b11110000, ...same(0b01100000, 5), 0b11110000], 3), // f
	pad(5, [0b01110110, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b01111100, 0b00001100, 0b11001100, 0b01111000]), // g
	pad(3, [0b11100000, 0b01100000, 0b01101100, 0b01110110, ...same(0b01100110, 5), 0b11100110], 3), // h
	pad(3, [0b00011000, 0b00000000, 0b00111000, ...same(0b00011000, 5), 0b00111100], 3), // i
	pad(4, [0b00110000, 0b00000000, 0b00110000, ...same(0b00110000, 5), 0b00110000, 0b01110000, 0b01100000]), // j
	pad(3, [0b11100000, 0b01100000, 0b01100110, 0b01101100, 0b01111000, 0b01111000, 0b01101100, 0b01100110, 0b11100110], 3), // k
	pad(3, [0b00111000, ...same(0b00011000, 8), 0b00111100], 3), // l
	pad(5, [0b11001100, 0b11111110, 0b11010110, 0b11010110, 0b11010110, 0b11000110, 0b11000110], 4), // m
	pad(5, [0b11111000, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100], 4), // n
	pad(5, [0b01111000, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b01111000], 4), // o
	pad(5, [0b11011100, 0b01100110, 0b01100110, 0b01100110, 0b01100110, 0b01111100, 0b01100000, 0b01100000, 0b11110000]), // p
	pad(5, [0b01110110, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b01111100, 0b00001100, 0b00001100, 0b00011110]), // q
	pad(5, [0b11011100, 0b01110110, 0b01100000, 0b01100000, 0b01100000, 0b01100000, 0b11110000], 4), // r
	pad(5, [0b01111100, 0b11000000, 0b01111000, 0b00001100, 0b00001100, 0b11001100, 0b01111000], 4), // s
	pad(3, [0b00010000, 0b00110000, 0b11111100, ...same(0b00110000, 5), 0b00011100], 3), // t
	pad(5, [0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b01110110], 4), // u
	pad(5, [0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b01111000, 0b00110000], 4), // v
	pad(5, [0b11000110, 0b11000110, 0b11000110, 0b11010110, 0b11010110, 0b11111110, 0b01101100], 4), // w
	pad(5, [0b11000110, 0b11000110, 0b01101100, 0b00111000, 0b00111000, 0b01101100, 0b11000110], 4), // x
	pad(5, [0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b11001100, 0b01111100, 0b00001100, 0b11001100, 0b01111000]), // y
	pad(5, [0b11111100, 0b10001100, 0b00011000, 0b00110000, 0b01100000, 0b11000100, 0b11111100], 4), // z

	pad(4, [...mirr([0b00011100, 0b00110000, 0b00110000], [0b01100000, 0b00110000])], 2), // {
	pad(4, same(0b00011000, 10), 2), // |
	pad(4, [...mirr([0b01110000, 0b00110000, 0b00110000], [0b00011000, 0b00110000])], 2), // }
	pad(3, [0b01110110, 0b11011100], 11), // ~
	pad(16, []), // DEL (127)
].flat();

console.log("import { asciiGlyphsToFont } from '../ascii-converter';");
console.log('');
console.log('const glyphs = [');

// Convert to ASCII art
for (let i = 0; i < 128; i++) {
	const start = i * 16;
	const bitmap = font8x16.slice(start, start + 16);
	const glyph = bitmapToAscii(bitmap, 8);
	console.log(formatGlyph(glyph, i));
}

console.log('];');
console.log('');
console.log('export default asciiGlyphsToFont(glyphs, 8);');
